# Contributor:
# Maintainer:
pkgname=mariner3d
pkgver=0.2.0
pkgrel=1
pkgdesc="Web interface for controlling MSLA 3D Printers based on Chitu controllers, such as the ones by Elegoo and Phrozen."
url="https://github.com/luizribeiro/mariner"
arch="noarch"
license="MIT"
depends="
	py3-pyserial
	py3-typing-extensions
	py3-toml
	py3-mypy-extensions
	py3-markupsafe
	py3-itsdangerous
	py3-click
	py3-wtforms
	py3-werkzeug
	py3-jinja2
	py3-pypng
	py3-waitress
	py3-flask
	py3-flask-wtf
	py3-flask-caching
	py3-typedstruct
	py3-pyre-extensions
	py3-whitenoise
"
makedepends="xz"
install=""
subpackages="mariner3d-pyc"
# source="
# $_pkgreal-3e793cf9067b52f2f1b68c84fa8a887bbc75626e.tar.gz::https://github.com/luizribeiro/mariner/archive/3e793cf9067b52f2f1b68c84fa8a887bbc75626e.tar.gz
# mariner-frontend.patch
# "
source="
https://github.com/luizribeiro/mariner/releases/download/v${pkgver}-${pkgrel}/${pkgname}_${pkgver}-${pkgrel}_armhf.deb
mariner-frontend.patch
"
builddir="$srcdir/$pkgname-$pkgver-$pkgrel"
options="!check"

unpack() {
	ar --output "$srcdir" xf "$srcdir"/*.deb data.tar.xz
	mkdir -p "$builddir"
	tar -C "$builddir" -xf "$srcdir/data.tar.xz"
}

package() {
	mkdir -p "$pkgdir/usr/bin"
	cp "$builddir/opt/venvs/mariner3d/bin/mariner" "$pkgdir/usr/bin/"
	sitepkgs=$pkgdir`python3 -c "import site; print(site.getsitepackages()[0])"`
	frontenddir=$sitepkgs/mariner/frontend
	mkdir -p "$frontenddir"
	cp -r "$builddir/opt/venvs/mariner3d/lib/python3.7/site-packages/mariner"* "$sitepkgs/"
	cp -r "$builddir/opt/venvs/mariner3d/dist" "$frontenddir/"
}

sha512sums="
895575acd9ee59919a6ace6a33b9d80778c72a026764b006a5ad5abaa15cc06e4e5468f1d938c7561cc4c6dc7f566ea70cd636915c4ad23957ae65cabedf4a08  mariner3d_0.2.0-1_armhf.deb
c8e0b85161993e6224eaf8d58a9d38876695523f1c237ae91abef0c811e3dc531e82ed565f54f761137d1db02233a1b811971ef6602479dfa7fbd4705c4c559e  mariner-frontend.patch
"
